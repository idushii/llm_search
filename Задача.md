Техническое задание: Сервис итеративного поиска информации
----------------------------------------------------------

Введение
--------

Целью данного проекта является разработка сервиса итеративного поиска информации, который позволяет пользователю вводить исходный запрос через консоль. Полученный запрос будет обработан с использованием языковой модели (LLM) для генерации набора тем для поиска в интернете. Поиск будет выполняться с использованием SearchXNg на языке Python, а результаты будут предоставлены для дальнейшей обработки.


Функциональные требования
-------------------------

### 1. Ввод исходного запроса

*   Пользователь вводит исходный запрос через консоль.
*   Система проверяет корректность ввода и уведомляет пользователя в случае ошибок.

### 2. Обработка запроса с помощью LLM

*   Интеграция с выбранной языковой моделью через Rest API к llama-3.2-3b для преобразования исходного запроса в набор тем. Для этого используется запросы вида 
```bash
curl https://api.aitunnel.ru/v1/chat/completions \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer sk-aitunnel-xxx" \
    -d '{
      "model": "llama-3.2-3b",
      "max_tokens": 50000,
      "messages": [
        {
          "role": "user",
          "content": "Составь список тем для поиска в интернете по запросу: {{query}}"
        }
      ]
    }'
```
*   Генерация списка релевантных тем для проведения поиска.

### 3. Выполнение поиска с использованием SearchXNg

*   Автоматическое выполнение поисковых запросов по каждой сгенерированной теме.
*   Извлечение списка ссылок на найденные страницы из поисковых результатов в формате JSON.
*   Обход всех ссылок и получение результатов поиска в формате Markdown с использованием сервиса https://r.jina.ai/{{url}}
*   Сохранение каждой отдельной строницы в отдельный файл в /cache.
*   Сохранение списка тем в файл /topics_<query>.md
*   Сохранение результатов поиска в файл /results_<query>.json

Нефункциональные требования
---------------------------

*   **Производительность**: Быстрая обработка запросов и получение результатов поиска.
*   **Масштабируемость**: Возможность расширения функционала и интеграции с другими сервисами в будущем.
*   **Безопасность**: Обеспечение безопасности данных пользователя и предотвращение несанкционированного доступа.
*   **Документированность**: Полная документация кода и функционала для облегчения поддержки и дальнейшего развития.

Технологический стек
--------------------

*   **Язык программирования**: Python
*   **Модель LLM**: llama-3.2-3b (или аналогичная)
*   **Поисковый движок**: SearchXNg
*   **API для парсинга сайтов**: https://r.jina.ai/{{url}}
*   **Интерфейс пользователя**: Консольный интерфейс
*   **Дополнительные библиотеки**: requests, asyncio (для асинхронных запросов)

Архитектура системы
-------------------

### Компоненты

1.  **Интерфейс пользователя**: Обработка ввода и вывода через консоль.
2.  **Модуль обработки запросов**: Взаимодействие с LLM для генерации тем.
3.  **Модуль поиска**: Выполнение поисковых запросов через SearchXNg.
4.  **Модуль обработки результатов**: Сбор, фильтрация и структурирование данных.
5.  **Модуль управления сессиями**: Хранение истории запросов и результатов для итеративного поиска.

### Взаимодействие компонентов

1.  Пользователь вводит исходный запрос через консоль.
2.  Модуль обработки запросов отправляет запрос в LLM для генерации тем.
3.  Модуль поиска выполняет поисковые запросы по сгенерированным темам.
4.  Модуль обработки результатов собирает и структурирует полученные данные.
5.  Результаты возвращаются пользователю через консоль.
6.  Пользователь может принять решение о продолжении поиска на основе полученных данных, запустив итеративный процесс.

Варианты реализации и рекомендации
----------------------------------

*   **Асинхронность**: Использовать asyncio для выполнения поисковых запросов параллельно, что значительно ускорит процесс получения результатов.
*   **Кэширование**: Реализовать кэширование результатов поиска для предотвращения повторных запросов к одной и той же теме.
*   **Логирование**: Внедрить систему логирования для отслеживания работы сервиса и быстрого выявления ошибок.
*   **Тестирование**: Разработать модульные и интеграционные тесты для обеспечения надежности сервиса.
*   **Расширяемость**: Структурировать код таким образом, чтобы в будущем можно было легко интегрировать веб-интерфейс или другие способы взаимодействия.

### Файловая структура

```bash
.
├── main.py
├── planned.py
├── scraping.py
├── requirements.txt
├── README.md
└── .gitignore
```

### Лимиты запросов

*   **SearchXNg**: 10 запросов в минуту с равным интервалом между запросами
*   **Jina**: 5 запросов в секунду
*   **Aitunnel**: 2 запроса в секунду

### Примеры запросов

`как реализовать глубокий поиск в интернете на основе LLM`
